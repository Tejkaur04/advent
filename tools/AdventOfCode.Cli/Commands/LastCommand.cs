// Copyright (c) Rory Claasen. All rights reserved.
// Licensed under the MIT license. See LICENSE in the project root for license information.

namespace AdventOfCode.Cli.Commands;

using System.CommandLine;
using System.Linq;
using System.Threading;
using System.Threading.Tasks;
using AdventOfCode.Cli.Services;

internal sealed class LastCommand : BaseSolutionCommand
{
    public LastCommand(CommonOptions commonOptions, ISolutionFinder solutionFinder, ISolutionRunner solutionRunner)
        : base(commonOptions, solutionFinder, solutionRunner, "last", "Run the last solution for a given year")
    {
        this.Options.Add(commonOptions.Year);
    }

    protected override ValueTask<int> ExecuteAsync(ParseResult parseResult, CancellationToken cancellationToken)
    {
        var solver = this.SolutionFinder.GetLastSolver(parseResult.GetValue(this.CommonOptions.Year));
        var allResults = this.SolutionRunner.RunAll([solver]);
        var exitCode = allResults.Any(r => r.HasError) ? -1 : 0;
        return ValueTask.FromResult(exitCode);
    }
}
